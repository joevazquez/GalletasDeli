<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galletas Deli - Ordenar</title>
    <link rel="stylesheet" href="/static/css/catalogo-productos.css">
</head>
<body>
    <!-- Barra de navegación -->
    <nav class="navbar">
        <div class="nav-links">
            <a href="{{ url_for('catalogo_productos') }}" class="active">Ordenar</a>
            <a href="#">Rastrear</a>
        </div>
        <div class="logo">
            <img src="/static/images/logo_ventas.png" alt="Galletas Deli">
        </div>
        <div class="user-greeting">
            Hola, {{ user_name }}
        </div>
        
    </nav>

    <!-- Contenedor principal -->
    <div class="main-container">
        <!-- Lista de productos -->
        <div class="product-list">
            <div class="product-card">
                <img src="/static/images/galletas-besos-nuez.jpg" alt="Nuez">
                <p>Nuez</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('nuez', 'half-kilo', -1)">−</button>
                    <span id="nuez-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('nuez', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('nuez', 'six-pieces', -1)">−</button>
                    <span id="nuez-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('nuez', 'six-pieces', 1)">+</button>
                </div>
            </div>


            <div class="product-card">
                <img src="/static/images/galletas-naranja.jpg" alt="Naranja">
                <p>Naranja</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('naranja', 'half-kilo', -1)">−</button>
                    <span id="naranja-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('naranja', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('naranja', 'six-pieces', -1)">−</button>
                    <span id="naranja-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('naranja', 'six-pieces', 1)">+</button>
                </div>
            </div>


            <div class="product-card">
                <img src="/static/images/galletas-coco.jpg" alt="Coco">
                <p>Coco</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('coco', 'half-kilo', -1)">−</button>
                    <span id="coco-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('coco', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('coco', 'six-pieces', -1)">−</button>
                    <span id="coco-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('coco', 'six-pieces', 1)">+</button>
                </div>
            </div>

            <div class="product-card">
                <img src="/static/images/galletas-chocolate.jpg" alt="Chocolate">
                <p>Chocolate</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('chocolate', 'half-kilo', -1)">−</button>
                    <span id="chocolate-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('chocolate', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('chocolate', 'six-pieces', -1)">−</button>
                    <span id="chocolate-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('chocolate', 'six-pieces', 1)">+</button>
                </div>
            </div>

            <div class="product-card">
                <img src="/static/images/galletas-avena.jpg" alt="Avena">
                <p>Avena</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('avena', 'half-kilo', -1)">−</button>
                    <span id="avena-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('avena', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('avena', 'six-pieces', -1)">−</button>
                    <span id="avena-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('avena', 'six-pieces', 1)">+</button>
                </div>
            </div>

            <div class="product-card">
                <img src="/static/images/galletas-surtidas.jpg" alt="Surtidas">
                <p>Surtidas</p>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('surtidas', 'half-kilo', -1)">−</button>
                    <span id="surtidas-half-kilo-counter">0</span>
                    <button class="increment" onclick="updateCounter('surtidas', 'half-kilo', 1)">+</button>
                </div>
                <div class="counter">
                    <button class="decrement" onclick="updateCounter('surtidas', 'six-pieces', -1)">−</button>
                    <span id="surtidas-six-pieces-counter">0</span>
                    <button class="increment" onclick="updateCounter('surtidas', 'six-pieces', 1)">+</button>
                </div>
            </div>
        </div>

        <!-- Resumen del pedido -->
        <div class="order-summary">
            <h2>Resumen del Pedido</h2>
            <div class="prices">
                <p><strong>Precios:</strong></p>
                <p>Caja de medio kilo: $100</p>
                <p>Caja de 6 piezas: $50</p>
            </div>
            <div class="order-details" id="order-details">
                <!-- Actualización dinámica del pedido -->
            </div>
            <p class="total" id="order-total">Total: $0.00</p>

            <!-- Formulario para enviar el pedido -->
            <form action="{{ url_for('catalogo_productos') }}" method="POST">
                <input type="hidden" name="resumenPedido" id="resumenPedido">
                <input type="hidden" name="totalPedido" id="totalPedido">
                <button type="submit" class="btn-order">Ordenar</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        const prices = { "half-kilo": 100, "six-pieces": 50 }; // Precios por tipo de producto
        const orderSummary = {}; // Resumen del pedido

        // Actualiza los contadores y el resumen del pedido
        function updateCounter(product, type, change) {
            const counterId = `${product}-${type}-counter`;
            const counterElement = document.getElementById(counterId);
            let count = parseInt(counterElement.textContent, 10);

            // Asegúrate de que el contador nunca sea negativo
            count = Math.max(0, count + change);
            counterElement.textContent = count;

            // Actualiza el resumen del pedido
            if (!orderSummary[product]) {
                orderSummary[product] = { "half-kilo": 0, "six-pieces": 0 };
            }
            orderSummary[product][type] = count;

            updateOrderSummary();
        }

        function updateOrderSummary() {
            const orderDetails = document.getElementById("order-details");
            const orderTotal = document.getElementById("order-total");
            let total = 0;

            orderDetails.innerHTML = ""; // Limpia el contenido anterior

            for (const [product, quantities] of Object.entries(orderSummary)) {
                const { "half-kilo": halfKilo, "six-pieces": sixPieces } = quantities;

                if (halfKilo > 0 || sixPieces > 0) {
                    orderDetails.innerHTML += `
                        <p><strong>${capitalize(product)}:</strong></p>
                        ${halfKilo > 0 ? `<p>Cajas de medio kilo: ${halfKilo}</p>` : ""}
                        ${sixPieces > 0 ? `<p>Cajas de 6 piezas: ${sixPieces}</p>` : ""}
                    `;
                    total += halfKilo * prices["half-kilo"] + sixPieces * prices["six-pieces"];
                }
            }

            orderTotal.textContent = `Total: $${total.toFixed(2)}`;
            document.getElementById("resumenPedido").value = JSON.stringify(orderSummary); // Guardar como JSON
            document.getElementById("totalPedido").value = total.toFixed(2);
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
    </script>
</body>
</html>