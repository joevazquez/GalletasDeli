<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagar - Galletas Deli</title>
    <link rel="stylesheet" href="/static/css/payment.css">
</head>
<body>
    <div class="container">
        <!-- Encabezado -->
        <div class="header">
            <img src="/static/images/logo_ventas.png" alt="Logo Galletas Deli" class="logo">
            <h1>Galletas Deli</h1>
        </div>

        <!-- Resumen del Pedido -->
        <div class="summary">
            <h2>Resumen del Pedido</h2>
            <div id="order-details">
            </div>
            <p id="order-total">Total: $0.00</p>
        </div>

        <!-- Formulario para Dirección y Pago -->
        <form action="/procesar_pago" method="POST" class="payment-form">
            <h2>Dirección de Envío:</h2>
            <div class="input-group">
                <input type="text" id="estado" name="estado" placeholder="Estado" required>
            </div>
            <div class="input-group">
                <input type="text" id="ciudad" name="ciudad" placeholder="Ciudad" required>
            </div>
            <div class="input-group">
                <input type="text" id="delegacion" name="delegacion" placeholder="Delegación" required>
            </div>
            <div class="input-group">
                <input type="text" id="calle_numero" name="calle_numero" placeholder="Calle y Número" required>
            </div>
            <button type="button" class="btn-update-address" onclick="actualizarDireccion()">Actualizar Dirección</button>

            <h2>Datos de Tarjeta:</h2>
            <div class="input-group">
                <input type="text" id="numero_tarjeta" name="numero_tarjeta" placeholder="Número de tarjeta" required>
            </div>
            <div class="input-group">
                <input type="text" id="fecha_expiracion" name="fecha_expiracion" placeholder="Fecha de expiración (MM/AA)" required>
            </div>
            <div class="input-group">
                <input type="text" id="cvv" name="cvv" placeholder="CVV" required>
            </div>

            <!-- Botón de Pagar -->
            <button type="submit" class="btn-pay">Pagar</button>
        </form>
    </div>

    <!-- Scripts -->
    <script>
        // Obtener resumen del pedido desde la página del catálogo
        const resumenPedido = localStorage.getItem('resumenPedido');
        const totalPedido = localStorage.getItem('totalPedido');

        // Mostrar los datos del pedido en la sección correspondiente
        const orderDetails = document.getElementById('order-details');
        const orderTotal = document.getElementById('order-total');

        if (resumenPedido && totalPedido) {
            orderDetails.innerHTML = resumenPedido;
            orderTotal.textContent = `Total: $${totalPedido}`;
        } else {
            orderDetails.innerHTML = "<p>No hay productos seleccionados.</p>";
            orderTotal.textContent = "Total: $0.00";
        }

        // Función para actualizar la dirección
        function actualizarDireccion() {
            const estado = document.getElementById('estado').value;
            const ciudad = document.getElementById('ciudad').value;
            const delegacion = document.getElementById('delegacion').value;
            const calleNumero = document.getElementById('calle_numero').value;

            // Realizar una petición al backend para actualizar la dirección del usuario
            fetch('/actualizar_direccion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    estado,
                    ciudad,
                    delegacion,
                    calle_numero: calleNumero
                })
            })
            .then(response => {
                if (response.ok) {
                    alert("Dirección actualizada exitosamente.");
                } else {
                    alert("Error al actualizar la dirección.");
                }
            })
            .catch(error => {
                console.error("Error en la solicitud:", error);
                alert("Error al actualizar la dirección.");
            });
        }
    </script>
</body>
</html>
